const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TableChart-DGBqz3qv.js","assets/index-BihdxwCx.js","assets/index-EnnwHpsG.js","assets/index-g7eDV2oR.css","assets/TableComp-Cva8wTaw.js","assets/Pagination.vue_vue_type_script_setup_true_lang-8rQMbW_n.js","assets/Table.vue_vue_type_script_setup_true_lang-D3CVJytt.js","assets/HeadUlo.vue_vue_type_script_setup_true_lang-yGkPrJpQ.js","assets/Input.vue_vue_type_script_setup_true_lang-B1V_pvvB.js","assets/Checkbox.vue_vue_type_script_setup_true_lang-CA-6HTad.js","assets/nullish-CHIgUVhi.js","assets/useFormControl-Cx8bc3UZ.js","assets/VisuallyHiddenInput-BBo1LaOe.js","assets/Label-h-CnGbub.js","assets/FilterDate-D4V1WFt4.js","assets/Select.vue_vue_type_script_setup_true_lang-VP94Q_cd.js","assets/Chip.vue_vue_type_script_setup_true_lang-CGbjm09Q.js"])))=>i.map(i=>d[i]);
import{g as z,n as H,s as J,q as M,r as v,j as G,v as K,y as Q,c as I,o as m,a as d,d as V,b as _,w as N,l as X,h as y,k as L,m as f,z as S,e as Y,B as C}from"./index-EnnwHpsG.js";import{m as Z}from"./HeadUlo.vue_vue_type_script_setup_true_lang-yGkPrJpQ.js";import{S as k,E as x}from"./ErrorComp-CX6x4EY6.js";import"./jspdf.es.min-DoA4uwA0.js";import{s as ee}from"./websockets-BARde-ae.js";import{u as te}from"./UseBp-DtsHt15h.js";import{_ as oe}from"./ExportToCsv.vue_vue_type_script_setup_true_lang-B8KwYs3u.js";const ae={class:"text-2xl mx-2 my-10 font-bold self-start"},ne={class:"flex gap-4 mt-3 px-3 flex-wrap items-end justify-start w-full"},se={class:"w-full p-2"},le={key:1},re={class:"w-full p-2"},ye=z({__name:"historicalData",setup(ie){var w,B;const D=H(),t=J(),{auth:p,verify:ue}=M(),{getBp:h,getBpCustom:ce}=te(),R=S({loader:()=>C(()=>import("./TableChart-DGBqz3qv.js"),__vite__mapDeps([0,1,2,3])),loadingComponent:k,delay:200,errorComponent:x,timeout:3e3}),F=S({loader:()=>C(()=>import("./TableComp-Cva8wTaw.js"),__vite__mapDeps([4,5,2,3,6,7,8,9,10,11,12,13])),loadingComponent:k,delay:200,errorComponent:x,timeout:3e3}),P=S({loader:()=>C(()=>import("./FilterDate-D4V1WFt4.js"),__vite__mapDeps([14,15,2,3,16,7,11,10])),loadingComponent:k,delay:200,errorComponent:x,timeout:3e3}),s=v(((B=(w=t==null?void 0:t.query)==null?void 0:w.filter)==null?void 0:B.toString())||"daily"),b=new Date(Date.now()),i=v(b.toISOString()),u=v(b.toISOString());G(s,async()=>{(s==null?void 0:s.value)!=="custom"&&D.replace({query:{filter:s.value}})});const a=v(null);let o=null;const g=(r,e,l)=>(o=ee(`historical?filter=${r??"daily"}${e&&l?`&from=${e}&to=${l}`:""}`),o.onopen=n=>{console.log("WebSocket connection established")},o.onmessage=async n=>{a.value=JSON.parse(n.data)},o.onclose=()=>{console.log("Websocket connection has been closed")},o.onerror=n=>{console.log(n)},o);K(async()=>{var r,e,l,n;s.value!=="custom"&&(a.value=await h((e=(r=t==null?void 0:t.query)==null?void 0:r.filter)==null?void 0:e.toString()),g((n=(l=t==null?void 0:t.query)==null?void 0:l.filter)==null?void 0:n.toString()))}),Q(()=>{o==null||o.close()});const W=async()=>{var r,e,l,n;if(s.value!=="custom"){a.value=await h((e=(r=t==null?void 0:t.query)==null?void 0:r.filter)==null?void 0:e.toString()),p&&(o==null||o.close(),g((n=(l=t==null?void 0:t.query)==null?void 0:l.filter)==null?void 0:n.toString()));return}if(s.value==="custom"&&u.value&&i.value){D.replace({query:{filter:"custom",from:new Date(u.value).toISOString(),to:new Date(i.value).toISOString()}}),p&&(o==null||o.close(),g("custom",String(u.value),String(i.value)));return}};return(r,e)=>{var E,U,q,A,O,T,$;const l=X,n=Z,j=Y;return m(),I("section",null,[d("h1",ae,[e[4]||(e[4]=V(" Historical readings ")),_(n,null,{default:N(()=>[_(l,{class:"text-white",to:{name:"guidelines"}},{default:N(()=>e[3]||(e[3]=[V("?")])),_:1})]),_:1})]),d("div",ne,[((E=a.value)==null?void 0:E.length)!==void 0&&((U=a.value)==null?void 0:U.length)>0&&f(p)?(m(),y(oe,{key:0,class:"self-start me-auto",Data:a.value,name:(q=f(p))==null?void 0:q.id},null,8,["Data","name"])):L("",!0),_(f(P),{filter:s.value,"onUpdate:filter":e[0]||(e[0]=c=>s.value=c),"custom-from":u.value,"onUpdate:customFrom":e[1]||(e[1]=c=>u.value=c),"custom-to":i.value,"onUpdate:customTo":e[2]||(e[2]=c=>i.value=c),class:"self-end"},null,8,["filter","custom-from","custom-to"]),_(j,{class:"shadow-xl dark:text-white",label:"Apply Filter",onClick:W})]),d("div",se,[((A=a.value)==null?void 0:A.length)!==void 0&&((O=a.value)==null?void 0:O.length)>0?(m(),y(f(R),{key:0,Data:a.value},null,8,["Data"])):(m(),I("div",le,e[5]||(e[5]=[d("p",{class:"text-center"},"No data found",-1)])))]),d("div",re,[((T=a.value)==null?void 0:T.length)!==void 0&&(($=a.value)==null?void 0:$.length)>0?(m(),y(f(F),{key:0,Data:a.value},null,8,["Data"])):L("",!0)])])}}});export{ye as default};
